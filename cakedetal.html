<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/cakeIndex.css">
    <link rel="stylesheet" href="css/commont.css">
</head>
<body>
    <header>
        <div class="w1200 cl">
            <h1><img src="img/logo.png" alt=""></h1>
            <ul class="nav cl">
                <li><a href="index.html">首页</a></li>
                <li><a href="cakeList.html">蛋糕</a></li>
                <li><a href="cakeList.html">面包</a></li>
                <li><a href="cakeList.html">冰淇淋</a></li>
                <li><a href="cakeList.html">咖啡下午茶</a></li>
                <li><a href="cakeList.html">咖啡全国送</a></li>
                <li><a href="cakeList.html">企业专区</a></li>
            </ul>
            <div class="rightPart" style="float: left;width: 440px;height:80px;"> 
                <a href=""class="appDownlode" style="color:#974029;">APP下载</a>
                <div class="qrCode">
                    <img src="img/footer-erweima.png" alt="">
                    <p>下载享更多优惠</p>
                </div>
                <div class="city">上海<i></i></div>
                <ul class="cityList">   
                    <li><a href="">北京</a></li>
                    <li><a href="">上海</a></li>
                    <li><a href="">武汉</a></li>
                    <li><a href="">杭州</a></li>
                    <li><a href="">天津</a></li>
                    <li><a href="">苏州</a></li>
                    <li><a href="">深圳</a></li>
                </ul>
                <a href="" class="headerMasg">消息</a>
                <ul class="messageList">
                    <li><a href="" target="_blank">通知</a></li>
                    <li><a href="" target="_blank">物流</a></li>
                </ul>

                <span id="btn">
                    <a href="login.html" >登陆/</a><a href="register.html">注册</a>
                </span> 

                <div class="shoppingCart" style="width: 80px;height: 40px;display:inline-block;">
                    <span style="width: 60px;height: 30px;font-size: 14px;margin-left: 15px;"><a href="shoppingCart.html" style="color:#974029;">购物车</a></span>
                    <i style="font-size: 16px;color:#974029"></i>
                </div>
            </div>
    </div>
    </header>
    <section>
        <div class="w1200 cl">
            <div id="box">
                <div id="top">
                    <img src="" alt="" id="smallImg">
                    <div id="shadow"></div>
                    <div id="bigshadow">
                        <img src="" alt="" id="bigImg">
                    </div>
                </div>
                <ul id="showImg">
                   
                </ul>
            </div>
            <div id="info" >
                   
            </div>
    </section>
    <footer>
            <div class="w1200">
                <img src="img/footer-logo.png" alt="" class="footerlogo" height="36" width="96">
                <div class="footer-nav">
                        <a href="">联系我们</a>
                        <span>|</span>
                        <a href="">订购帮助</a>
                        <span>|</span>
                        <a href="">企业合作</a>
                        <span>|</span>
                        <a href="">生产经营资质</a>
                        <span>|</span>
                        <a href="">公告专区</a>
                </div>
                <div class="footer-icon cl">
                    <a href="http://weibo.com/21cake" target="_blank" class="footer-weibo">
                        <img src="img/footericon-01.png" alt="" width="30px" height="30px">
                    </a>
                    <a class="footer-weixin">
                        <div class="footer-erweima footer-weixin-erweima">
                            <img src="img/erweima.png"alt="" width="100px" height="100px">
                        </div>
                        <img src="img/footericon-02.png"alt="" width="30px" height="30px">
                    </a>
                    <a class="footer-app">
                        <div class="footer-erweima footer-app-erweima">
                            <img src="img/footer-erweima.png" alt="" width="120px" height="120px">
                        </div> 
                         APP
                    </a>
                </div>
            <div class="footer-text">
                    <span>订购专线：400 650 2121（服务时间 08:00–22:00）</span>
                    <span>客服电话：021-23099721（全国） | kefu@21cake.com（邮箱）</span>
                    <span>杭州/广州：提前5小时预订；北京：提前6小时预订；上海：提前5.5-6小时预订；天津/苏州/无锡/深圳：提前8小时预订（部分偏远地区除外，当日22点以后订单，于次日8点开始审核） </span>
                    <span>当日蛋糕配送截止下单时间：北京：16:50；上海：16:30；杭州/广州：13:50；天津：10:30；苏州/无锡/深圳：11:00</span>
                    <span>网站注册公司名称: 北京廿一客食品有限公司 地址: 北京市北京经济技术开发区兴海二街5号院3号楼 </span>
            </div>
            <div class="footer-copyright">
                <span>Copyright© 21Cake蛋糕官网商城 2007-2018, 版权所有 <a style="color: #9a9a9a" target="_blank" href="http://www.miitbeian.gov.cn/">京ICP备14006254号-1</a></span>
            </div>
        </footer>
</body>
<script src="js/jquery-1.11.3.js"></script>
<script src="js/cookie.js"></script>
<script>
    var loginName = getCookie("loginName");
    if (loginName) {
        $("#btn").html(loginName + "<span onclick ='existLogin()'>退出</span>").children().css("marginLeft","5px");

    } else {
        $("#btn").html("<span onclick='gotoLogin()'>点击登录</span>");
    }
    
    function gotoLogin() {
        setCookie("backURL", window.location.href, 7);
        window.location.href = "login.html";

    }

    function existLogin() {
        setCookie("loginId", "", -7);
        setCookie("loginName", "", -7);
        $("#btn").html("<span onclick='gotoLogin()'>点击登录</span>");
    }







    var infoDiv = document.getElementById("info");
    var showImg =document.getElementById("showImg");
    var searchStr = window.location.search;//?goodsid=2
    if(searchStr.indexOf("goodsid") !=-1){
        var id = searchStr.split("?")[1].split("=")[1];
        var req = new XMLHttpRequest();
        req.open("get","php/getDetail.php",true);
        req.send();
        req.onreadystatechange = function(){
            if(req.readyState == 4 && req.status == 200){
                let result = req.responseText;
                let list = JSON.parse(result);
                let goodsInfo =list.filter(function(item){
                         return item.goodsid == id;
                })[0];
                // console.log(goodsinfo);
                let goodsid = goodsInfo.goodsid
                let goodsname = goodsInfo.goodsname;
                let goodsdetail = goodsInfo.goodsdetails;
                let goodsprice = goodsInfo.goodsprice;
                let goodsnum = goodsInfo.goodsnum;
                let smallName = goodsInfo.bigimg;
                // console.log(smallName);
                let bigName = goodsInfo.bigimg;
                infoDiv.innerHTML =` 
                     <p id="goodsname">${goodsname}</p>
                    <p id="goodsdetail">${goodsdetail}</p>
                    <p id="goodsprice">${(goodsprice*1).toFixed(2)}<span>/2.0磅</span></p>
                    <p id="goodsnum"> 
                        <span>数量：</span>
                        <inputbigName type="text" value="${goodsnum}">
                    </p>
                    <button id="shoppingBtn" onclick="addShpppingcar(${goodsid},'${goodsname}','${smallName}',${goodsprice},1)">加入购物车</button>`;
                
                smallImg.src = "img/" + smallName;
                bigImg.src = "img/" + smallName;

                for(var i=0;i<3;i++){
                    var li = document.createElement("li");
                    li.setAttribute("data-small","img/" + smallName);
                    li.setAttribute("data-big","img/" + bigName);
                    var img = document.createElement("img");
                    img.src = "img/" + smallName;
                    li.appendChild(img);
                    showImg.appendChild(li);
                }
            }
        }
    }

    function addShpppingcar(goodsid,goodsname,goodsimg,goodsprice,goodsnum){
    // alert(goodsid);
    var loginId = getCookie("loginId");
    console.log(loginId);
    if(loginId){
        $.ajax({
            type:"get",
            url:"php/addmyshoppingcar.php",
            data:{
                userid:loginId,
                goodsid:goodsid,
                goodsname:goodsname,
                goodsimg:goodsimg,
                goodsprice:goodsprice,
                goodsnum:goodsnum
            },
            dataType:"json",
            success: function (data) {
                if(data.code == 1) {
                        if(confirm("加入成功 是否进入购物车结算")){
                            window.location.href = "shoppingCart.html";
                        }
                    } else {
                        alert(data.msg)
                }
            }
        });


    }else{
        if (confirm("您还没有登录 是否立即登录")) {
                gotoLogin();
            }
        }
    }

    var loginId = getCookie("loginId");
    $.ajax({
            type: "get",
            url: "php/getnum.php",
            data: {
                userid: loginId
            },
            dataType: "json",
            success: function (data) {
                var count = data["count"];
                console.log(count);
                $(".shoppingCart i").html(count);
            }
        })



    var box = document.getElementById("box");
    var topDiv = document.getElementById("top");
    var bigshadow = document.getElementById("bigshadow");
    var bigImg = document.getElementById("bigImg");
    var smallImg = document.getElementById("smallImg");
    var showImgList = document.querySelectorAll("#showImg li");
    var shadow = document.getElementById("shadow");

   var topWidth = parseInt(getStyleAttr(topDiv,"width"));
    var shadowWidth = parseInt(getStyleAttr(shadow,"width"));
    var maxX = topWidth - shadowWidth;
    var boxMarginLeft = parseInt(getStyleAttr(box,"marginLeft"));
    var boxMarginTop = parseInt(getStyleAttr(box,"marginTop"));
    var topHeight = parseInt(getStyleAttr(topDiv,"height"));
    var maxY= topHeight - shadowWidth;
    var bigImgWidth = parseInt(getStyleAttr(bigImg,"width"));
    var bigImgHeight = parseInt(getStyleAttr(bigImg,"height"));

    for(var i = 0 ; i < showImgList.length;i++){
        var li = showImgList[i];
        li.onmouseover = function(){
            var dataSmall = this.getAttribute("data-small");//鼠标经过的时候获取date-small这个属性
            smallImg.src = dataSmall;
            var dataBig = this.getAttribute("data-big");
            bigImg.src = dataBig;
        }
    }

    topDiv.onmousemove = function(e){
        var evt = window.event || e;
        var clientX = evt.clientX;
        var clientY = evt.clientY;
        var scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft;
        var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

        var x =  clientX +  scrollLeft - shadowWidth/2 - boxMarginLeft-25;
        var y = clientY + scrollTop - shadowWidth/2 -  topHeight/4;
        if(x <=0){
            x = 0;
        }
        if(x >= maxX){
            x = maxX;
        }
        if(y <= 0){
            y = 0;
        }
        if(y >= maxY){
            y = maxY;
        }

        shadow.style.left = x + "px";
        shadow.style.top = y + "px";
        shadow.style.display = "block";
        // x:400 = ?:800

        var bigX = (bigImgWidth* x)/topWidth;
        var bigY = (bigImgHeight * y)/topHeight;

        bigImg.style.left = -bigX + "px";
        bigImg.style.top = -bigY + "px";
        bigshadow.style.display = "block";
    }
    topDiv.onmouseout = function (){
        shadow.style.display ="none";
        bigshadow.style.display = "none";
    }





     function getStyleAttr(obj, attr) {
        if (window.getComputedStyle) {
            return window.getComputedStyle(obj)[attr];
        } else {
            return obj.currentStyle[attr];
        }
    }



    $(".appDownlode").mouseover(function(e){
        $(".qrCode").slideDown(1000);
        e.stopPropagation();
    }).mouseout(function(){
        $(".qrCode").slideUp(500);
    });


    $(".headerMasg").mouseover(function(e){
        $(".messageList").slideDown(1000);
        e.stopPropagation();
    }).mouseout(function(){
        $(".messageList").slideUp(500);
    });
</script>
</html>